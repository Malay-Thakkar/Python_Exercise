{% extends "sidebar.html" %}
{% load static %}
{% block dashboard-content %}
<style>
  .modal-content {
    background-color: ivory;
  }
</style>
{% if messages %}
<div class="alert alert-primary" role="alert" id="messages-container"
  style="position: absolute;z-index: 1;width: 100%;">
  {% for message in messages %}
  {{ message }}
  {% endfor %}
</div>
{% endif %}

<script>
  // Function to hide the messages container after 3 seconds
  setTimeout(function () {
    var messagesContainer = document.getElementById('messages-container');
    if (messagesContainer) {
      messagesContainer.style.display = 'none';
    }
  }, 3000); // 3000 milliseconds = 3 seconds
</script>

<h1>Products</h1>
<main class="main bd-grid" id="product-container">
  <div class="container mt-3">
    <div class="d-flex">
      <div class="mr-auto p-2">
        <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#add_productModal">
          Add Product
        </button>
        <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal"
          data-bs-target="#add_multiple_productModal">
          Add Multiple Products
        </button>
      </div>
      <div class="p-2">
        <!-- Search bar -->
        <form class="d-flex pl-5" method="POST" action="{% url 'search' %}">
          {% csrf_token %}
          <div class="input-group">
            <input class="form-control bg-light" type="search" placeholder="Search product" name="search"
              aria-label="Search">
            <button class="btn btn-outline-success" type="submit">Search</button>
          </div>
        </form>
      </div>
    </div>
    <div class="d-flex flex-wrap align-items-center mb-3">
    </div>
    <div class="table-responsive">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Image</th>
              <th>Name</th>
              <th>Price</th>
              <th>Stock</th>
              <th>Update Item</th>
              <th>Delete Item</th>
            </tr>
          </thead>
          <tbody id="productList">
            {% for product in products %}
            <tr>
              <td><img class="card-img" src="../../media/{{product.img}}" alt="Product Image"></td>
              <td>{{product.name}}</td>
              <td>{{product.price}}</td>
              <td>{{product.stock}}</td>
              <td>
                <form action="{% url 'adminproductsupdate' product_id=product.product_id %}" method="get">
                  <button class="btn btn-info update-button" type="submit">Update</button>
              </form>
                </td>
              <td><button class="btn btn-danger delete-button" data-index="{{product.product_id}}" data-bs-toggle="modal" data-bs-target="#deleteModal">Delete</button></td>
            </tr>            
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <h2>Total Stock: stock total price</h2>
  </div>
</main>

<!-- for add product popup -->
<!-- Modal -->
<div class="modal" id="add_productModal" tabindex="-1" aria-labelledby="add_productModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="add_productModalLabel">add_product product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        add_product Product
        <div>
          <div class="form-group ">
            <label class="col-sm-2 control-label ">
              Name
            </label>
            <div class="col-sm-10">
              <input name="name" class="form-control" type="text" value="">
            </div>
          </div>
          <div class="form-group ">
            <label class="col-sm-2 control-label ">
              Price
            </label>
            <div class="col-sm-10">
              <input name="price" class="form-control" type="number" value="">
            </div>
          </div>
          <div class="form-group ">
            <label class="col-sm-2 control-label ">
              Unit
            </label>
            <div class="col-sm-10">
              <input name="unit" class="form-control" type="text" value="">
            </div>
          </div>
          <div class="form-group ">
            <label class="col-sm-2 control-label ">
              Stock
            </label>
            <div class="col-sm-10">
              <input name="stock" class="form-control" type="number" value="">
            </div>
          </div>
          <div class="form-group ">
            <label class="col-sm-2 control-label ">
              Desc
            </label>
            <div class="col-sm-10">
              <input name="desc" class="form-control" type="text" value="">
            </div>
          </div>
          <div class="form-group ">
            <label class="col-sm-2 control-label ">
              Img
            </label>
            <div class="col-sm-10">
              <input name="img" type="file" value="">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label ">
              Category
            </label>
            <div class="col-sm-10">
              <select class="form-control" name="category">
                <option value="http://127.0.0.1:8000/api/category/1/">Cadbury</option>
                <option value="http://127.0.0.1:8000/api/category/2/">Nestle</option>
                <option value="http://127.0.0.1:8000/api/category/3/">Kinder Joy</option>
              </select>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary js-tooltip" title=""
              data-original-title="Make a POST request on the Product List resource">POST</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger add_product-product" data-index="{{ product.product_id }}">add_product</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- for add multiple product popup -->
<!-- Modal -->
<div class="modal fade" id="add_multiple_productModal" tabindex="-1" aria-labelledby="add_multiple_productModalLabel"
  aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="add_multiple_productModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <form action="/action_page.php">
          <input type="file" id="myFile" name="filename">
          <input type="submit">
        </form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<!-- for final delete popup -->
<!-- Modal -->
<div class="modal" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Confirm Delete Account</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to permanently delete this product?
      </div>
      <div class="modal-footer">
        <form method="post" id="delete-form">
          {% csrf_token %}
          <input type="hidden" name="_method" value="DELETE">
          <button class="btn btn-danger" id="delete-button" type="submit">Delete</button>
        </form>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<script>
  // for delete 
  document.querySelectorAll('.delete-button').forEach(button => {
    button.addEventListener('click', function() {
      var product_id = this.getAttribute('data-index');
      var form = document.getElementById('delete-form');
      form.action = "{% url 'adminproductsdelete' product_id=999 %}".replace('999', product_id); 
    });
  });

  </script>
{% endblock dashboard-content %}